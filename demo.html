<!DOCTYPE html>
<html>
    <head>
        <title>Demo</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css"/>
        <link rel="stylesheet" href="ios7.min.css"/>
        <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
        <script type="text/javascript">
          var mouseX, mouseY, touchX, touchY, sketch1, sketch2;
          var imageObj = new Image();
          imageObj.src = 'star.png';

          function drawDot(ctx, w, h, x, y, cat1, cat2, cat3, cat4) {
              ctx.clearRect(0, 0, w, h);
              drawRotatedText(ctx, 180, 20, 0, cat1);
              drawRotatedText(ctx, 20, 180,  - Math.PI / 2, cat2);
              drawRotatedText(ctx, 340, 180, Math.PI / 2, cat3);
              drawRotatedText(ctx, 180, 340, 0, cat4);
              ctx.drawImage(imageObj, x - (imageObj.width / 2), y - (imageObj.height / 2));
          }

          // Get the current mouse position relative to the top-left of the canvas
          function getMousePos(e) {
              if (!e)
                  var e = event;

              if (e.offsetX) {
                  mouseX = e.offsetX;
                  mouseY = e.offsetY;
              }
              else if (e.layerX) {
                  mouseX = e.layerX;
                  mouseY = e.layerY;
              }
          }

          function getTouchPos(e) {
              if (!e)
                  var e = event;

              if (e.touches) {
                  if (e.touches.length == 1) {
                      var touch = e.touches[0];
                      touchX = touch.pageX - touch.target.offsetLeft;
                      touchY = touch.pageY - touch.target.offsetTop;
                  }
              }
          }

          function drawRotatedText(ctx, endingX, centerY, radianAngle, text) {
              // save the starting context state (untransformed)
              ctx.save();
              // set the desired font
              ctx.font = '300 14px -apple-system,-apple-system-font,".SFNSDisplay-Regular",".Helvetica NeueUI","Helvetica Neue",sans-serif';
              ctx.fillStyle = '#6d6d72';
              // measure the pixel width of the text
              var width = ctx.measureText(text).width;
              // translate to the desired endpoint
              ctx.translate(endingX, centerY);
              // rotate to the desired angle
              ctx.rotate(radianAngle);
              // set the text baseline so the text 
              // is vertically centered on the endpoint 
              ctx.textBaseline = 'middle';
              // draw the text offset by the negative width
              // so the text ends at the desired endpoint
              ctx.fillText(text,  - width / 2, 0);
              // restore the context to its starting state
              ctx.restore();
          }

          function sketchpad(my_sketchpad, cat1, cat2, cat3, cat4) {
              // Get the specific canvas element from the HTML document passed
              this.name = my_sketchpad;
              this.canvas = document.getElementById(my_sketchpad);
              this.cat1 = cat1;
              this.cat2 = cat2;
              this.cat3 = cat3;
              this.cat4 = cat4;
              this.x = 0;
              this.y = 0;

              if (this.canvas.getContext)
                  this.ctx = this.canvas.getContext('2d');

              drawRotatedText(this.ctx, 180, 20, 0, this.cat1);
              drawRotatedText(this.ctx, 20, 180,  - Math.PI / 2, this.cat2);
              drawRotatedText(this.ctx, 340, 180, Math.PI / 2, this.cat3);
              drawRotatedText(this.ctx, 180, 340, 0, this.cat4);

              this.clearCanvas = function () {
                  this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
              }

              this.sketchpad_touchStart = function () {
                  getTouchPos();
                  if (touchX > 30 && touchX < 330 && touchY > 30 && touchY < 330) {
                      var cat1r = touchX < 180 ? this.cat2 : this.cat3;
                      var cat2r = touchY < 180 ? this.cat1 : this.cat4;
                      //document.getElementById(this.name+"r").innerHTML = "touchX: "+touchX+", touchY: "+touchY;
                      document.getElementById(this.name + "r").innerHTML = "You prefer to go to more " + cat1r.toLowerCase() + " and " + cat2r.toLowerCase() + " venues.";
                      this.x = touchX;
                      this.y = touchY;
                      drawDot(this.ctx, this.canvas.width, this.canvas.height, touchX, touchY, this.cat1, this.cat2, this.cat3, this.cat4);
                  }
                  // Prevents an additional mousedown event being triggered
                  event.preventDefault();
              }

              this.sketchpad_mouseDown = function (e) {
                  getMousePos(e);
                  if (mouseX > 30 && mouseX < 330 && mouseY > 30 && mouseY < 330) {
                      var cat1r = mouseX < 180 ? this.cat2 : this.cat3;
                      var cat2r = mouseY < 180 ? this.cat1 : this.cat4;
                      document.getElementById(this.name + "r").innerHTML = "You prefer to go to more " + cat1r.toLowerCase() + " and " + cat2r.toLowerCase() + " venues.";
                      this.x = mouseX;
                      this.y = mouseY;
                      drawDot(this.ctx, this.canvas.width, this.canvas.height, mouseX, mouseY, this.cat1, this.cat2, this.cat3, this.cat4);
                  }
              }

              

              if (this.ctx) {
                  this.canvas.addEventListener('mousedown', this.sketchpad_mouseDown.bind(this), false);
                  this.canvas.addEventListener('touchstart', this.sketchpad_touchStart.bind(this), false);
              }
          }

          function init() {
              sketch1 = new sketchpad('c1', 'EXPENSIVE', 'FAMILIAR', 'EXOTIC', 'CHEAP');
              sketch2 = new sketchpad('c2', 'ROMANTIC', 'CASUAL', 'FINE', 'FAMILY');
          }
          
          (function() {

    // get viewport size
    getViewportSize = function() {
        return {
            height: window.innerHeight,
            width: window.innerWidth
        };
    };

    // update canvas size
    updateSizes = function() {
        var viewportSize = getViewportSize();
        var ctx1 = $("#c1")[0].getContext('2d');
        var ctx2 = $("#c2")[0].getContext('2d');
        ctx1.canvas.height = ctx2.canvas.height = ctx1.canvas.width = ctx2.canvas.width = viewportSize.width * 0.8;
        $("#c1")[0].css({ 
     "background-size": (ctx1.canvas.height-60)+" "+(ctx1.canvas.width-60)
});
 $("#c2")[0].css({ 
     "background-size": (ctx2.canvas.height-60)+" "+(ctx2.canvas.width-60)
});
    };
    $(window).on('resize', function() {
        updateSizes();
    });
}());
        </script>
        <style>
            .sketchpad {
                background-size: 300px 300px;
                background-image: url("graph.jpg");
                background-repeat: no-repeat;
                background-position: center;
                border-radius: 4px;
                position: relative;
            }
        </style>
    </head>
    <body onload="init()">
        <div data-role="page" id="pageone">
            <div data-role="header">
                <h1 style="overflow: visible;">Register an Experience</h1>
            </div>
            <div data-role="main" class="ui-content" style="text-align: center;">
                <div>
                    <h2 class="title">Description</h2>
                </div>
                <ul>
                    <li>
                        <p>Please use the following graphs to best describe the venue's experience.</p>
                    </li>
                </ul>
                <a href="#pagetwo" class="ui-btn ui-corner-all ui-shadow" data-transition="slide" data-role="button">Start</a>
            </div>
        </div>
        <div data-role="page" id="pagetwo">
            <div data-role="header">
                <h1 style="overflow: visible;">Register an Experience</h1>
            </div>
            <div data-role="main" class="ui-content" style="text-align: center;">
                <!--<div>
                    <h2 class="title">First</h2>
                </div>-->
                <div class="ui-grid-solo">
                    <div class="ui-block-a">
                        <canvas id="c1" class="sketchpad" height="360" width="360"></canvas>
                    </div>
                </div>
                <a href="#pagethree" class="ui-btn ui-corner-all ui-shadow" data-transition="slide" data-role="button">Next</a>
            </div>
        </div>
        <div data-role="page" id="pagethree">
            <div data-role="header">
                <h1 style="overflow: visible;">Register an Experience</h1>
            </div>
            <div data-role="main" class="ui-content" style="text-align: center;">
                <!--<div>
                    <h2 class="title">First</h2>
                </div>-->
                <div class="ui-grid-solo">
                    <div class="ui-block-a">
                        <canvas id="c2" class="sketchpad" height="360" width="360"></canvas>
                    </div>
                </div>
                <a href="#pagefour" class="ui-btn ui-corner-all ui-shadow" data-transition="slide" data-role="button">Next</a>
            </div>
        </div>
        <div data-role="page" id="pagefour">
            <div data-role="header">
                <h1 style="overflow: visible;">Register an Experience</h1>
            </div>
            <div data-role="main" class="ui-content" style="text-align: center;">
                <div>
                    <h2 class="title">Result</h2>
                </div>
                <ul>
                    <li>
                        <p id="c1r">You prefer to go to more expensive and exotic venues</p>
                    </li>
                    <li>
                        <p id="c2r">You prefer to go to more romantic and casual venues</p>
                    </li>
                </ul>
                <a href="demo.html" target="_self" class="ui-btn ui-corner-all ui-shadow" data-role="button">Save</a>
            </div>
        </div>
    </body>
</html>
